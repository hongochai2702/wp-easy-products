jQuery(function(t){"use strict";var e=t(document);t.fn.tpfwImagePicker=function(){var n={},i=function(t){var e=[];if(""!=t){var n=t.split(",");for(var i in n){var a=n[i].split("|");e.push(a[0])}}return e};e.on("click",".tpfw-image_picker .add_images",function(e){e.preventDefault();var a=t(this).closest(".tpfw-image_picker"),l=a.find('input[type="hidden"]');n[a.attr("id")]?n[a.attr("id")].open():(n[a.attr("id")]=wp.media.frames.file_frame=wp.media({title:"Add Images",button:{text:"Add Images"},library:{type:"image"},multiple:a.data("multiple")}),n[a.attr("id")].on("open",function(){var e,o;""!=(e=i(l.val()))&&(o=n[a.attr("id")].state().get("selection"),t(e).each(function(t,e){var n;(n=wp.media.attachment(e)).fetch(),o.add(n?[n]:[])}))}),n[a.attr("id")].on("select",function(){var e,o;e=[],o=n[a.attr("id")].state().get("selection");var r=i(l.val()),s="";o.map(function(n){var i=(n=n.toJSON()).sizes.hasOwnProperty("thumbnail")?n.sizes.thumbnail.url:n.url;""!=r&&-1!==t.inArray(n.id.toString(),r)||(s+='<li class="added" data-id="'+n.id+'">\n                                    <div class="inner">\n                                        <img alt="'+n.title+'" src="'+i+'"/>\n                                    </div>\n                                    <a href="#" class="remove"></a>\n                                </li>',i=i.replace(tpfw_var.upload_url,""),e.push(n.id+"|"+encodeURIComponent(i)))}),e.length>0&&(a.data("multiple")?(""!=r&&(e=r.concat(e)),a.find(".image_list").append(s)):a.find(".image_list").html(s),l.val(e).change())}),n[a.attr("id")].open())}),e.on("click",".tpfw-image_picker .remove",function(e){e.preventDefault();var n=t(this),i=n.closest(".tpfw-image_picker").find('input[type="hidden"]'),a=i.val(),l=n.closest("li").index();""!=a&&(delete(a=a.split(","))[l],a=a.filter(function(t){return t})),i.val(a).change(),n.closest("li").remove()}),t.fn.sortable&&t(".tpfw-image_picker .image_list").sortable({stop:function(e,n){var i=[],a=t(n.item[0]).parent();a.find("li").each(function(){i.push(t(this).attr("data-id"))}),a.closest(".tpfw-image_picker").find('input[type="hidden"]').val(i)}})},t.fn.tpfwLink=function(){e.on("click",".tpfw-link .link_button",function(e){e.preventDefault();var n,i,a,l,o,r,s,p,c;n=t(this).closest(".tpfw-link"),i=n.find("input.tpfw_value"),a=n.find(".url-label"),l=n.find(".title-label"),o=i.data("json"),r=t("#wp-link-submit"),s=t('<input type="button" name="tpfw_link-submit" id="tpfw_link-submit" class="button-primary" value="Set Link">'),r.hide(),t("#tpfw_link-submit").remove(),s.insertBefore(r),p=t('<div class="link-target tpfw-link-nofollow"><label><span></span> <input type="checkbox" id="tpfw-link-nofollow"> Add nofollow option to link</label></div>'),t("#link-options .tpfw-link-nofollow").remove(),p.insertAfter(t("#link-options .link-target")),setTimeout(function(){var e=t("#most-recent-results").css("top");t("#most-recent-results").css("top",parseInt(e)+p.height())},200),(c=window.wpLink).open("content"),"string"==typeof o.url&&t("#wp-link-url").length?t("#wp-link-url").val(o.url):t("#url-field").val(o.url),"string"==typeof o.url&&t("#wp-link-text").length?t("#wp-link-text").val(o.title):t("#link-title-field").val(o.title),t("#wp-link-target").length?t("#wp-link-target").prop("checked",o.target.length):t("#link-target-checkbox").prop("checked",o.target.length),t("#tpfw-link-nofollow").length&&t("#tpfw-link-nofollow").prop("checked",o.rel.length),s.unbind("click.tpfwLink").bind("click.tpfwLink",function(e){e.preventDefault(),e.stopImmediatePropagation();var n,o={};o.url=t("#wp-link-url").length?t("#wp-link-url").val():t("#url-field").val(),o.title=t("#wp-link-text").length?t("#wp-link-text").val():t("#link-title-field").val();var p=t(t("#wp-link-target").length?"#wp-link-target":"#link-target-checkbox");return o.target=p[0].checked?" _blank":"",o.rel=t("#tpfw-link-nofollow")[0].checked?"nofollow":"",n=t.map(o,function(t,e){return"string"==typeof t&&0<t.length?e+":"+encodeURIComponent(t):void 0}).join("|"),i.val(n).change(),i.data("json",o),a.html(o.url+o.target),l.html(o.title),c.close("noReset"),window.wpLink.textarea="",r.show(),s.unbind("click.tpfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.tpfwLink"),p.attr("checked",!1),t("#most-recent-results").css("top",""),t("#tpfw-link-nofollow").attr("checked",!1),!1}),t("#wp-link-cancel").unbind("click.tpfwLink").bind("click.tpfwLink",function(e){return e.preventDefault(),c.close("noReset"),s.unbind("click.tpfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.tpfwLink"),t("#wp-link-close").unbind("click.tpfwCloseLink"),window.wpLink.textarea="",!1}),t("#wp-link-close").unbind("click").bind("click.tpfwCloseLink",function(e){return e.preventDefault(),c.close("noReset"),s.unbind("click.tpfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.tpfwLink"),t("#wp-link-close").unbind("click.tpfwCloseLink"),window.wpLink.textarea="",!1})})},t.fn.tpfwMap=function(){if(window.hasOwnProperty("google"))return this.each(function(e,n){if(!n.id.includes("__i__")){var i=t(this),a={};a.zoom=14,a.map=new google.maps.Map(i.find(".map_canvas")[0],{zoom:4,center:new google.maps.LatLng(40.590377,-97.726872)}),a.marker=null,a.overideMap=function(t){null!=a.marker&&(a.marker.setMap(null),a.marker=null),a.marker=new google.maps.Marker({position:t,draggable:!0,animation:google.maps.Animation.DROP,icon:a.iconMarker}),a.map.setCenter(t),a.map.setZoom(a.zoom),a.marker.setMap(a.map),google.maps.event.addListener(a.marker,"dragend",a.onDragMarker),google.maps.event.addListener(a.map,"zoom_changed",a.onZoomChanged)},a.onDragMarker=function(t){var e=t.latLng,n=e.lat()+","+e.lng()+"|"+a.zoom;i.find("input.tpfw_value").val(n).change()},a.onZoomChanged=function(){a.zoom=a.map.getZoom();var e=i.find("input.tpfw_value").val();if(""!=t.trim(e)){var n=(e=e.split("|"))[0]+"|"+a.zoom;i.find("input.tpfw_value").val(n).change()}},a.onLoad=function(){var e=i.find("input.tpfw_value").val();if(i.addClass("map_loaded"),""!=t.trim(e)){var n=(e=e.split("|"))[0].split(",");n=new google.maps.LatLng(t.trim(n[0]),t.trim(n[1])),a.zoom=""!=t.trim(e[1])?parseInt(e[1]):14,a.overideMap(n)}},i.find(".js-map_search").geocomplete().bind("geocode:result",function(t,e){var n=e.geometry.location,l=n.lat()+","+n.lng()+"|"+a.zoom;i.find("input.tpfw_value").val(l).change(),a.overideMap(n)}),setTimeout(a.onLoad,500)}})},t.fn.tpfwRepeater=function(){t(this).each(function(){var e=t(this).repeater({defaultValues:{},show:function(){t(this).slideDown()},hide:function(e){t(this).slideUp(e)},ready:function(){},render:{image_picker:function(e,n,i){var a=i.split(",");if(a.length>0){var l="";t.each(a,function(t,e){2===(e=e.split("|")).length&&(l+='<li class="added" data-id="'+e[0]+'">\n                                                    <div class="inner">\n                                                        <img alt="" src="'+tpfw_var.upload_url+decodeURIComponent(e[1])+'"/>\n                                                    </div>\n                                                    <a href="#" class="remove"></a>\n                                                </li>')}),e.parent().find(".image_list").append(l)}},color_picker:function(e,n,i){e.val(i),e.wpColorPicker({change:function(e,n){t(e.target).val(n.color.toString()).change()}})},icon_picker:function(t,e,n){t.val(n).change(),t.fontIconPicker()},checkbox:function(t,e,n){if(""!=n){n=n.split(",");var i=t.next();for(var a in n)i.find('input[value="'+n[a]+'"]').attr("checked","checked")}},select:function(e,n,i){var a=e.parent().find("select");if(""!=i){"string"==typeof i&&(i=i.split(","));for(var l in i)a.find('option[value="'+i[l]+'"]').attr("selected","selected");a.change()}void 0!==a.attr("multiple")&&a.selectize({plugins:["remove_button","drag_drop"],onChange:function(e){t(this)[0].$wrapper.closest(".repeater-col-field").find("input.tpfw_value").val(e).change()}})},autocomplete:function(t,e,n){var i=t.parent().find("select");if(""!=n){"string"==typeof n&&(n=n.split(","));for(var a in n)i.find('option[value="'+n[a]+'"]').attr("selected","selected");i.change()}i.tpfwAutocomplete()},link:function(t,e,n){var i=n.split("|"),a={};if(i.length>1){for(var l in i){var o=i[l].split(":");a[o[0]]=decodeURIComponent(o[1])}t.data("json",a),t.parent().find(".url-label").html(a.url+a.target),t.parent().find(".title-label").html(a.title)}},datetime:function(t){t.datetimepicker(t.data())}}}),n=e.data("value");"object"==typeof n&&e.setList(n),e.find("div[data-rpt_dependency]").length&&e.find("div[data-rpt_dependency]").initRepeaterDependency()}),e.on("click",".tpfw-repeater [data-repeater-edit], .tpfw-repeater .tpfw-widget-title h4",function(n){var i=t(this).closest(".tpfw-widget");i.hasClass("open")?i.find(".tpfw-widget-inside").slideUp("fast",function(){i.removeClass("open")}):i.find(".tpfw-widget-inside").slideDown("fast",function(){i.addClass("open"),e.trigger("tpfw-repeater-item-opened",[i])}),n.preventDefault()})},t.fn.tpfwTypography=function(){var e={},n=!1,i=function(e,n,i){var a={"font-family":n.value},l=e.find(".subsets select"),o=e.find(".variants select"),r=l[0].selectize,s=o[0].selectize;if(""!=n.variants){var p=n.variants.split(","),c=[],d=tpfw_var.variants;for(var f in n.variants){w=d.hasOwnProperty(p[f])?d[p[f]]:p[f];c.push({text:w,value:p[f]})}if(s.enable(),s.clearOptions(),s.addOption(c),"object"==typeof i&&i.hasOwnProperty("variants")){var u=i.variants.split(",");s.addItems(u)}else s.addItems(p);a.variants=n.variants}else s.clearOptions(),s.disable();if(""!=n.subsets){var v=n.subsets.split(","),c=[],h=tpfw_var.subsets;for(var f in v){var w=h.hasOwnProperty(v[f])?h[v[f]]:v[f];c.push({text:w,value:v[f]})}if(r.enable(),r.clearOptions(),r.addOption(c),"object"==typeof i&&i.hasOwnProperty("subsets")){var m=i.subsets.split(",");r.addItems(m)}else t.inArray("latin",v)>=0&&(r.addItem("latin"),a.subsets="latin")}else r.clearOptions(),r.disable();"function"==typeof i&&i(a)},a=t(this),l=a.find(".font_family select");a.find(".variants select").selectize({plugins:["remove_button"],create:!1,onChange:function(i){if(!n){var a=t(this)[0].$wrapper.closest(".tpfw-typography"),l=a.data("id"),o=e[l];if(""!=a.data("value")&&o.hasOwnProperty("variants")){o.variants=i.join(",");var r=encodeURIComponent(JSON.stringify(o));e[l]=o,a.find(".tpfw_value").val(r).change()}}}}),a.find(".subsets select").selectize({plugins:["remove_button"],create:!1,onChange:function(i){if(!n){var a=t(this)[0].$wrapper.closest(".tpfw-typography"),l=a.data("id"),o=e[l];if(""!=a.data("value")&&o.hasOwnProperty("subsets")){o.subsets=i.join(",");var r=encodeURIComponent(JSON.stringify(o));e[l]=o,a.find(".tpfw_value").val(r).change()}}}}),l.selectize({labelField:"label",valueField:"value",searchField:"label",create:!1,options:tpfw_var.fonts,render:{option:function(t){return"<div class='option' data-value='"+t.value+"' data-variants='"+t.variants+"' data-subsets='"+t.subsets+"'>"+t.label+" </div>"}},onInitialize:function(){var n=t(this)[0].$wrapper.closest(".tpfw-typography"),i=n.data("id");e[i]={};var a=n.data("value");if(""!=a){var l=JSON.parse(decodeURIComponent(a));l.hasOwnProperty("font-family")&&(e[i]=l,t(this)[0].addItem(l["font-family"]))}},onChange:function(a){if(n=!0,""!=a){var l=t(this)[0].$wrapper.closest(".tpfw-typography"),o=l.data("id"),r=e[o];r.hasOwnProperty("font-family")&&r["font-family"]===a?i(l,this.options[a],r):i(l,this.options[a],function(t){r["font-family"]=t["font-family"],r.subsets=t.subsets,r.variants=t.variants;var n=encodeURIComponent(JSON.stringify(r));l.find(".tpfw_value").val(n).change(),e[o]=r}),n=!1}}}),a.on("change",".subrow input, .subrow select",function(n){var i=t(this).data("key"),a=t(this),l=a.closest(".tpfw-typography"),o=l.data("id");if(""!=a.val()){e[o][i]=a.val();var r=encodeURIComponent(JSON.stringify(e[o]));l.find(".tpfw_value").val(r).change()}n.preventDefault()})},t.fn.tpfwAutocomplete=function(){t(this).selectize({valueField:"value",searchField:"label",labelField:"label",options:[],create:!1,plugins:["remove_button","drag_drop"],render:{option:function(t,e){return'<div class="option" data-value="'+t.value+'">#'+t.value+" - "+e(t.label)+"</div>"}},load:function(e,n){var i=t(this)[0].$wrapper.closest(".tpfw-field"),a=i.data("min_length");if(e.length<parseInt(a))return n();var l=i.data("ajax_type"),o=i.data("ajax_value");t.ajax({url:ajaxurl,type:"GET",data:{action:"tpfw_autocomplete_"+l,types:o,s:e},error:function(){n()},success:function(t){n(t)}})}})},t.fn.initWidgetDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name");if(void 0!=e&&_.isObject(e)){var i="#";t(this).closest(".widget").length&&(i="#widget-"+t(this).closest(".widget").find("input.widget-id").val()+"-");var a=Object.keys(e);_.each(a,function(t){e[i+t]=e[t],delete e[t]}),t("#"+n+".tpfw_value").dependsOn(e)}})},t.fn.initRepeaterDependency=function(){t(this).each(function(){var e=t(this).closest(".tpfw_repeater__item").index(),n=t(this).closest(".tpfw-repeater").attr("data-name")+"-"+e+"-",i=t(this).data("rpt_dependency"),a=t(this).data("param_name");if(void 0!=i&&_.isObject(i)){var l=Object.keys(i);_.each(l,function(t){i["#"+n+t]=i[t],delete i[t]}),t("#"+n+a+".tpfw_value").dependsOn(i)}})},t.fn.initMenuDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name"),i=t(this).data("menu_item");if(void 0!=e&&"object"==typeof e){var a=Object.keys(e);t.each(a,function(t,n){e["#"+n+"-"+i]=e[n],delete e[n]}),t("#"+n+".tpfw_value").dependsOn(e)}})},t.fn.initDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name");if(void 0!=e&&"object"==typeof e){var i=Object.keys(e);t.each(i,function(t,n){e["#"+n]=e[n],delete e[n]}),t("#"+n+".tpfw_value").dependsOn(e)}})}});var Tpfw_Repeater_Item=function(t,e,n){"use strict";var i=this;this.list=t,this.container=e,this.control=t.prev(".tpfw_value"),this.container.on("keyup change",".tpfw_value",function(){i.setValues()}),this.setValues=function(){var t=[];i.list.find("[data-repeater-item]").each(function(){var e={};jQuery(this).find(".tpfw_value").each(function(){var t=jQuery(this);if("radio"!=t.attr("type")||"radio"==t.attr("type")&&t.is(":checked")){var n=jQuery(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];e[n]=jQuery(this).val()}}),t.push(e)}),i.control.val(JSON.stringify(t)).trigger("change")},n&&i.setValues()};